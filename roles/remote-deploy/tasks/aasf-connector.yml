---
#
# aasf-infra-auto/roles/remote-deploy/tasks/aasf-connector.yml
#

# bulk
# control
# data

# aasf-connector-bulk.service.j2
# aasf-connector-bulk.sysconfig.j2
# aasf-connector-control.service.j2
# aasf-connector-control.sysconfig.j2
# aasf-connector-data.service.j2
# aasf-connector-data.sysconfig.j2

- name: create logging stub files for aasf-connector subcomponents
  file:
    path="/var/log/{{ component }}/{{ subcomponent }}.log"
    owner={{ component }}
    group={{ rem_user_grp }}
    mode=0664
    state=touch
  with_items:
    - bulk
    - bulk-err
    - control
    - control-err
    - data
    - data-err
  loop_control:
    loop_var: subcomponent

- name: put sysconfig and service files into place for aasf-connector subcomponents
  template:
    src="{{ component }}-{{ subcomponent.name }}.{{ subcomponent.type }}.j2"
    dest="{{ subcomponent.target }}/{{ component }}-{{ subcomponent.name }}.{{ subcomponent.type }}"
    owner=root
    group=root
    mode=0644
    backup=no
  with_items:
    - { name: 'bulk', type: 'sysconfig', target: '/etc/sysconfig' }
    - { name: 'bulk', type: 'service', target: '/lib/systemd/system' }
    - { name: 'control', type: 'sysconfig', target: '/etc/sysconfig' }
    - { name: 'control', type: 'service', target: '/lib/systemd/system' }
    - { name: 'data', type: 'sysconfig', target: '/etc/sysconfig' }
    - { name: 'data', type: 'service', target: '/lib/systemd/system' }
  loop_control:
    loop_var: subcomponent

- name: enable aasf-connector subcomponent services
  service:
    enabled=yes
    state=restarted
    name="{{ component }}-{{ subcomponent }}"
  with_items:
    - bulk
    - control
    - data
  loop_control:
    loop_var: subcomponent
    
